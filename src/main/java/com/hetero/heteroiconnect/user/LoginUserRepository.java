package com.hetero.heteroiconnect.user;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

@Repository 
public interface LoginUserRepository extends JpaRepository<LoginUser, Long> {
   
   
    /*Page<MstUser> findByUserFullnameContainsAndIsActiveTrueAndIsDeletedFalse(String name, Pageable page);

    Page<MstUser> findByUserFirstnameContainsAndUserLastnameContainsAndIsActiveTrueAndIsDeletedFalse(String name, Pageable page);

    Page<MstUser> findAllByIsActiveTrueAndIsDeletedFalse(Pageable page);

    List<MstUser> findByUserFullnameContaifns(String key);*/
   
	
	//// for production 
	
	 @Query(value = "SELECT A.EMPLOYEESEQUENCENO 'EmpID', A.COMPANYID 'BUID',CONCAT(md5(:userName),md5(:password)) PWD,A.EMPLOYEEID HRMSEMPLOYEEID,A.CALLNAME 'NAME',A.FIRSTNAME 'FIRSTNAME',A.LASTNAME 'LASTNAME', STATUS.NAME 'STATUS',co.NAME 'COSTCENTER', GEN.NAME 'GENDER', GEN.GENDER 'GENDERID', EMPLO.NAME 'EMPLOYMENT TYPE', IFNULL(STROKE.NAME,'--') 'INCREMENT TYPE',  IFNULL(IF(STATUS.NAME='ACTIVE','--',HR.DATE),'') 'LWD', DATE_FORMAT(A.DATEOFBIRTH,'%d-%m-%Y') 'DOB',  IFNULL(DATE_FORMAT(PROFILE.DATEOFJOIN,'%d-%M-%Y'),'') DOJ, BU.NAME 'DIVISION',  IFNULL(DES.NAME,'') 'DESIGNATION', IFNULL(DEP.NAME,'') 'DEPARTMENT',  CONCAT(MN.EMPLOYEESEQUENCENO,'-',MN.CALLNAME) 'Reportee',MS.NAME 'Reportee_Status', BANK.BANKID, IFNULL(BANK.BANKNAME,   'NA') 'BANKNAME', IFNULL(BIFSC.BANKIFC,'NA') 'IFSC', IFNULL(OTHER.ACCOUNTNO,'NA') 'ACCOUNTNO',   IFNULL(PRO.EMAIL,'') 'PROEMAIL', IFNULL(D.EMAIL,'') 'PEMAIL', IFNULL(OTHER.PFNO,     'NA') PFNO,   IFNULL(OTHER.ESINO,    'NA')ESINO, IFNULL(OTHER.PFUAN,    'NA')PFUAN, IFNULL(EMPST.STATE,'') STATE,   IFNULL(HQLOC.NAME,'') HQ, IFNULL(RLOC.NAME,'') REGION, IFNULL(PRO.MOBILE,'') 'PROFESSIONAL_MOBILE',   IFNULL(D.MOBILE,'')'PERSONAL_MOBILE', IFNULL(D.MOBILE,'')'PERSONAL_PHONE',   IFNULL(D.COMMUNICATIONADDRESS,'')COMMUNICATIONADDRESS,   IFNULL(D.COMMUNICATIONADDRESS2,'')COMMUNICATIONADDRESS2,   IFNULL(D.COMMUNICATIONADDRESS3,'')COMMUNICATIONADDRESS3,   IFNULL(D.COMMUNICATIONADDRESS4,'')COMMUNICATIONADDRESS4, IFNULL(COMMLOC.NAME,'') COMMCITY,   IFNULL(COMMSTATELOC.NAME,'')COMMSTATE, COMMSTATELOC.LOCATIONID COMMSTATE_LOCATIONID,COMMLOC.LOCATIONID COMMCITY_LOCATIONID,IFNULL(D.COMMUNICATIONZIP,'') COMM_ZIP,   IFNULL(D.PERMANENTADDRESS,'')PERMANENTADDRESS, IFNULL(D.PERMANENTADDRESS2,'')PERMANENTADDRESS2,   IFNULL(D.PERMANENTADDRESS3,'')PERMANENTADDRESS3, IFNULL(D.PERMANENTADDRESS4,'')PERMANENTADDRESS4,   IFNULL(PLOC.NAME,'') PCITY, IFNULL(PSLOC.NAME,'')PSTATE,IFNULL(D.PERMANENTZIP,'') PZIPCODE,PSLOC.LOCATIONID PERSTATE_LOCATIONID,PLOC.LOCATIONID PERCITY_LOCATIONID,IFNULL(INFO.PASSPORTNO,'') 'PASSPORTNO', IFNULL(INFO.AADHAARCARDNO,'') 'AADHAARCARDNO',   IFNULL(INFO.AADHAARUID,'NA') 'AADHAARUID', IFNULL(INFO.AADHAARNAME,'NA') 'AADHAARNAME',   IFNULL(INFO.PAN,'NA') 'PAN', IFNULL(IMPRS.assetpropertyvalue,'0.00') 'IMPRESTAMT',   QUALI.QUALIFICATION 'Education_Details', IFNULL(PREV.PREV,'0') 'Prev_Exp',CUREXP.Exp 'Cur_Exp' ,ice.ADDRESS ICEADDRESS,ice.ADDRESS2 ICEADDRESS2,ice.ADDRESS3 ICEADDRESS3,ice.ADDRESS4 ICEADDRESS4,ice.MOBILE ICEMOBILE,ice.FIRSTNAME ICE_FIRSTNAME,ice.LASTNAME ICE_LASTNAME,CONCAT(ice.FIRSTNAME,' ',ice.LASTNAME) CONTACTPERSONNAME,ICESTATELOC.NAME 'ICESTATE',ICELOC.NAME 'ICECITY',IFNULL(ICESTATELOC.LOCATIONID,'0') 'ICE_STATE_ID',IFNULL(ICELOC.LOCATIONID,'0') 'ICE_CITY_ID',rel.RELATIONID,rel.RELATIONNAME, CONCAT(SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1))/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1))/12, '.',-1)))*12,0)) TOTALEXP,NOW() TODAYDATE,BU.CODE LOCATION,IF(BU.BUSINESSUNITID in(15,16,33,34),'ASSAM',BU.CALLNAME) SUBLOCATION,DATEDIFF(NOW(),PROFILE.DATEOFJOIN)+1 WORKINGDAYS,IF(IFNULL(NT.EMPLOYEEID,'0')=0,'FALSE','TRUE') NOTICE,IF(SUBSTRING_INDEX(SUBSTRING_INDEX(procedure.GET_HOD_ID_NAME(A.EMPLOYEESEQUENCENO), '~', 2),'~', 1)='30546','TRUE',if('30546'=A.EMPLOYEESEQUENCENO,'TRUE' ,'FALSE')) WORKSHEET  FROM HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY A LEFT JOIN HCLADM_PROD.TBL_STATUS_CODES STATUS ON 	A.STATUS=STATUS.STATUS LEFT JOIN HCLADM_PROD.TBL_BUSINESSUNIT BU 	ON A.COMPANYID=BU.BUSINESSUNITID LEFT JOIN hclhrm_prod.tbl_employee_personal_contact D 	ON A.EMPLOYEEID=D.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PLOC 	ON D.PERMANENTLOCATIONID=PLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PSLOC ON PLOC.PARENT=PSLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMLOC ON D.COMMUNICATIONLOCATIONID=COMMLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMSTATELOC ON COMMLOC.PARENT=COMMSTATELOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_profile PROFILE ON A.EMPLOYEEID=PROFILE.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_details DD ON A.EMPLOYEEID=DD.EMPLOYEEID LEFT JOIN HCLADM_PROD.TBL_DEPARTMENT DEP ON DD.DEPARTMENTID=DEP.DEPARTMENTID LEFT JOIN HCLADM_PROD.TBL_DESIGNATION DES ON DD.DESIGNATIONID=DES.DESIGNATIONID LEFT JOIN test.empl_states EMPST ON A.EMPLOYEEID=EMPST.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION RLOC ON DD.SUBLOCATIONID=RLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION HQLOC ON DD.WORKLOCATIONID=HQLOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_other_detail OTHER ON A.EMPLOYEEID=OTHER.EMPLOYEEID LEFT JOIN hclhrm_prod_others.tbl_emp_bank_ifc BIFSC ON A.EMPLOYEEID=BIFSC.EMPID LEFT JOIN hcladm_prod.tbl_bank_details BANK ON OTHER.BANKID=BANK.BANKID LEFT JOIN HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY MN ON DD.MANAGERID=MN.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_status_codes MS ON MS.STATUS=MN.STATUS LEFT JOIN hclhrm_prod.tbl_employee_personalinfo INFO ON A.EMPLOYEEID=INFO.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_contact PRO ON A.EMPLOYEEID=PRO.EMPLOYEEID LEFT JOIN ( SELECT EMPLOYEEID,MAX(LASTWORKINGDATE) DATE FROM HCLHRM_PROD.TBL_EMPLOYEE_HRACTIONS GROUP BY EMPLOYEEID ) HR ON A.EMPLOYEEID=HR.EMPLOYEEID LEFT JOIN (  select  assetpropertyvalue,issueddate,returneddate,employeeid from  hclhrm_prod.tbl_employee_assets where assetid=16 and status=1001 group by employeeid )IMPRS ON  IMPRS.employeeid=A.employeeid  LEFT JOIN ( SELECT EMPLOYEEID,GROUP_CONCAT(QUALIFICATIONID,'-',YEAROFPASSING) QUALIFICATION FROM   hclhrm_prod.tbl_employee_education_details GROUP BY EMPLOYEEID ) QUALI ON A.EMPLOYEEID=QUALI.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1)/12,'.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1)/12,'.',-1)))*12,0)) 'Exp' FROM   HCLHRM_PROD.TBL_EMPLOYEE_PROFILE GROUP BY EMPLOYEEID ) CUREXP ON A.EMPLOYEEID=CUREXP.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',-1)))*12,0)) PREV,SUM(EXPERIENCE) TOTALPREV FROM   hclhrm_prod.tbl_employee_experience_details GROUP BY EMPLOYEEID ) PREV ON A.EMPLOYEEID=PREV.EMPLOYEEID   LEFT JOIN HCLHRM_PROD.tbl_employment_types EMPLO ON A.EMPLOYMENTTYPEID=EMPLO.EMPLOYMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_increment_type STROKE ON DD.INCREMENTTYPEID=STROKE.INCREMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_gender GEN ON A.GENDER=GEN.GENDER   LEFT JOIN hcladm_prod.tbl_costcenter co on co.COSTCENTERID=a.COSTCENTERID   left join hclhrm_prod.tbl_employee_login lg on lg.employeeid=a.employeeid  left join tbl_employee_ice_contact ice on ice.employeeid=a.employeeid LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICELOC ON ICE.LOCATIONID=ICELOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICESTATELOC ON ICELOC.PARENT=ICESTATELOC.LOCATIONID LEFT JOIN  hclhrm_prod_others.tbl_iconnect_profile_pics pc on pc.employeeid=A.EMPLOYEESEQUENCENO LEFT JOIN hcladm_prod.tbl_relations rel on rel.RELATIONID=ice.RELATIONID LEFT JOIN test.tbl_employee_notice nt on nt.employeeid=A.EMPLOYEESEQUENCENO    WHERE  lg.EMPLOYEECODE=:userName and lg.password = MD5(:password) and a.status in(1001,1092,1401)   group by a.employeeid ORDER BY A.EMPLOYEESEQUENCENO ;", nativeQuery = true)
	    // @Query(value = "select * from mst_user mu INNER JOIN mst_patient mp ON mp.patient_user_id = mu.user_id where mp.patient_mr_no = :userName AND mu.password = :password and mu.is_user_or_staff=false", nativeQuery = true)
    LoginUser findByUsernameandpassword(@Param("userName") String userName, @Param("password") String password);
    
	 @Query(value = "SELECT A.EMPLOYEESEQUENCENO 'EmpID', A.COMPANYID 'BUID',CONCAT(md5(:userName)) PWD,A.EMPLOYEEID HRMSEMPLOYEEID, A.CALLNAME 'NAME',A.FIRSTNAME 'FIRSTNAME',A.LASTNAME 'LASTNAME', STATUS.NAME 'STATUS',co.NAME 'COSTCENTER', GEN.NAME 'GENDER', GEN.GENDER 'GENDERID', EMPLO.NAME 'EMPLOYMENT TYPE', IFNULL(STROKE.NAME,'--') 'INCREMENT TYPE',  IFNULL(IF(STATUS.NAME='ACTIVE','--',HR.DATE),'') 'LWD', DATE_FORMAT(A.DATEOFBIRTH,'%d-%m-%Y') 'DOB',  IFNULL(DATE_FORMAT(PROFILE.DATEOFJOIN,'%d-%M-%Y'),'') DOJ, BU.NAME 'DIVISION',  IFNULL(DES.NAME,'') 'DESIGNATION', IFNULL(DEP.NAME,'') 'DEPARTMENT',  CONCAT(MN.EMPLOYEESEQUENCENO,'-',MN.CALLNAME) 'Reportee',MS.NAME 'Reportee_Status',BANK.BANKID,IFNULL(BANK.BANKNAME,   'NA') 'BANKNAME', IFNULL(BIFSC.BANKIFC,'NA') 'IFSC', IFNULL(OTHER.ACCOUNTNO,'NA') 'ACCOUNTNO',   IFNULL(PRO.EMAIL,'') 'PROEMAIL', IFNULL(D.EMAIL,'') 'PEMAIL', IFNULL(OTHER.PFNO,     'NA') PFNO,   IFNULL(OTHER.ESINO,    'NA')ESINO, IFNULL(OTHER.PFUAN,    'NA')PFUAN, IFNULL(EMPST.STATE,'') STATE,   IFNULL(HQLOC.NAME,'') HQ, IFNULL(RLOC.NAME,'') REGION, IFNULL(PRO.MOBILE,'') 'PROFESSIONAL_MOBILE',   IFNULL(D.MOBILE,'')'PERSONAL_MOBILE', IFNULL(D.MOBILE,'')'PERSONAL_PHONE',   IFNULL(D.COMMUNICATIONADDRESS,'')COMMUNICATIONADDRESS,   IFNULL(D.COMMUNICATIONADDRESS2,'')COMMUNICATIONADDRESS2,   IFNULL(D.COMMUNICATIONADDRESS3,'')COMMUNICATIONADDRESS3,   IFNULL(D.COMMUNICATIONADDRESS4,'')COMMUNICATIONADDRESS4, IFNULL(COMMLOC.NAME,'') COMMCITY,   IFNULL(COMMSTATELOC.NAME,'')COMMSTATE, COMMSTATELOC.LOCATIONID COMMSTATE_LOCATIONID,COMMLOC.LOCATIONID COMMCITY_LOCATIONID,IFNULL(D.COMMUNICATIONZIP,'') COMM_ZIP,   IFNULL(D.PERMANENTADDRESS,'')PERMANENTADDRESS, IFNULL(D.PERMANENTADDRESS2,'')PERMANENTADDRESS2,   IFNULL(D.PERMANENTADDRESS3,'')PERMANENTADDRESS3, IFNULL(D.PERMANENTADDRESS4,'')PERMANENTADDRESS4,   IFNULL(PLOC.NAME,'') PCITY, IFNULL(PSLOC.NAME,'')PSTATE,IFNULL(D.PERMANENTZIP,'') PZIPCODE,PSLOC.LOCATIONID PERSTATE_LOCATIONID,PLOC.LOCATIONID PERCITY_LOCATIONID,IFNULL(INFO.PASSPORTNO,'') 'PASSPORTNO', IFNULL(INFO.AADHAARCARDNO,'') 'AADHAARCARDNO',   IFNULL(INFO.AADHAARUID,'NA') 'AADHAARUID', IFNULL(INFO.AADHAARNAME,'NA') 'AADHAARNAME',   IFNULL(INFO.PAN,'NA') 'PAN', IFNULL(IMPRS.assetpropertyvalue,'0.00') 'IMPRESTAMT',   QUALI.QUALIFICATION 'Education_Details', IFNULL(PREV.PREV,'0') 'Prev_Exp',CUREXP.Exp 'Cur_Exp' ,ice.ADDRESS ICEADDRESS,ice.ADDRESS2 ICEADDRESS2,ice.ADDRESS3 ICEADDRESS3,ice.ADDRESS4 ICEADDRESS4,ice.MOBILE ICEMOBILE,ice.FIRSTNAME ICE_FIRSTNAME,ice.LASTNAME ICE_LASTNAME,CONCAT(ice.FIRSTNAME,' ',ice.LASTNAME) CONTACTPERSONNAME,ICESTATELOC.NAME 'ICESTATE',ICELOC.NAME 'ICECITY',IFNULL(ICESTATELOC.LOCATIONID,'0') 'ICE_STATE_ID',IFNULL(ICELOC.LOCATIONID,'0') 'ICE_CITY_ID',rel.RELATIONID,rel.RELATIONNAME, CONCAT(SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1))/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1))/12, '.',-1)))*12,0)) TOTALEXP,NOW() TODAYDATE,BU.CODE LOCATION,IF(BU.BUSINESSUNITID in(15,16,33,34),'ASSAM',BU.CALLNAME) SUBLOCATION,DATEDIFF(NOW(),PROFILE.DATEOFJOIN)+1 WORKINGDAYS,IF(IFNULL(NT.EMPLOYEEID,'0')=0,'FALSE','TRUE') NOTICE,IF(SUBSTRING_INDEX(SUBSTRING_INDEX(procedure.GET_HOD_ID_NAME(A.EMPLOYEESEQUENCENO), '~', 2),'~', 1)='30546','TRUE',if('30546'=A.EMPLOYEESEQUENCENO,'TRUE' ,'FALSE')) WORKSHEET FROM HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY A LEFT JOIN HCLADM_PROD.TBL_STATUS_CODES STATUS ON 	A.STATUS=STATUS.STATUS LEFT JOIN HCLADM_PROD.TBL_BUSINESSUNIT BU 	ON A.COMPANYID=BU.BUSINESSUNITID LEFT JOIN hclhrm_prod.tbl_employee_personal_contact D 	ON A.EMPLOYEEID=D.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PLOC 	ON D.PERMANENTLOCATIONID=PLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PSLOC ON PLOC.PARENT=PSLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMLOC ON D.COMMUNICATIONLOCATIONID=COMMLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMSTATELOC ON COMMLOC.PARENT=COMMSTATELOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_profile PROFILE ON A.EMPLOYEEID=PROFILE.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_details DD ON A.EMPLOYEEID=DD.EMPLOYEEID LEFT JOIN HCLADM_PROD.TBL_DEPARTMENT DEP ON DD.DEPARTMENTID=DEP.DEPARTMENTID LEFT JOIN HCLADM_PROD.TBL_DESIGNATION DES ON DD.DESIGNATIONID=DES.DESIGNATIONID LEFT JOIN test.empl_states EMPST ON A.EMPLOYEEID=EMPST.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION RLOC ON DD.SUBLOCATIONID=RLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION HQLOC ON DD.WORKLOCATIONID=HQLOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_other_detail OTHER ON A.EMPLOYEEID=OTHER.EMPLOYEEID LEFT JOIN hclhrm_prod_others.tbl_emp_bank_ifc BIFSC ON A.EMPLOYEEID=BIFSC.EMPID LEFT JOIN hcladm_prod.tbl_bank_details BANK ON OTHER.BANKID=BANK.BANKID LEFT JOIN HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY MN ON DD.MANAGERID=MN.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_status_codes MS ON MS.STATUS=MN.STATUS LEFT JOIN hclhrm_prod.tbl_employee_personalinfo INFO ON A.EMPLOYEEID=INFO.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_contact PRO ON A.EMPLOYEEID=PRO.EMPLOYEEID LEFT JOIN ( SELECT EMPLOYEEID,MAX(LASTWORKINGDATE) DATE FROM HCLHRM_PROD.TBL_EMPLOYEE_HRACTIONS GROUP BY EMPLOYEEID ) HR ON A.EMPLOYEEID=HR.EMPLOYEEID LEFT JOIN (  select  assetpropertyvalue,issueddate,returneddate,employeeid from  hclhrm_prod.tbl_employee_assets where assetid=16 and status=1001 group by employeeid )IMPRS ON  IMPRS.employeeid=A.employeeid  LEFT JOIN ( SELECT EMPLOYEEID,GROUP_CONCAT(QUALIFICATIONID,'-',YEAROFPASSING) QUALIFICATION FROM   hclhrm_prod.tbl_employee_education_details GROUP BY EMPLOYEEID ) QUALI ON A.EMPLOYEEID=QUALI.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1)/12,'.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1)/12,'.',-1)))*12,0)) 'Exp' FROM   HCLHRM_PROD.TBL_EMPLOYEE_PROFILE GROUP BY EMPLOYEEID ) CUREXP ON A.EMPLOYEEID=CUREXP.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',-1)))*12,0)) PREV,SUM(EXPERIENCE) TOTALPREV FROM   hclhrm_prod.tbl_employee_experience_details GROUP BY EMPLOYEEID ) PREV ON A.EMPLOYEEID=PREV.EMPLOYEEID   LEFT JOIN HCLHRM_PROD.tbl_employment_types EMPLO ON A.EMPLOYMENTTYPEID=EMPLO.EMPLOYMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_increment_type STROKE ON DD.INCREMENTTYPEID=STROKE.INCREMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_gender GEN ON A.GENDER=GEN.GENDER   LEFT JOIN hcladm_prod.tbl_costcenter co on co.COSTCENTERID=a.COSTCENTERID   left join hclhrm_prod.tbl_employee_login lg on lg.employeeid=a.employeeid  left join tbl_employee_ice_contact ice on ice.employeeid=a.employeeid LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICELOC ON ICE.LOCATIONID=ICELOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICESTATELOC ON ICELOC.PARENT=ICESTATELOC.LOCATIONID LEFT JOIN  hclhrm_prod_others.tbl_iconnect_profile_pics pc on pc.employeeid=A.EMPLOYEESEQUENCENO  LEFT JOIN hcladm_prod.tbl_relations rel on rel.RELATIONID=ice.RELATIONID LEFT JOIN test.tbl_employee_notice nt on nt.employeeid=A.EMPLOYEESEQUENCENO  WHERE  A.EMPLOYEESEQUENCENO=:userName  and a.status in(1001,1092,1401)   group by a.employeeid ORDER BY A.EMPLOYEESEQUENCENO ;", nativeQuery = true)
	  LoginUser findByUsername(@Param("userName") String userName);
	 
	 //// Temp Login for JavaTeam Testing
	 
	 @Query(value = "SELECT A.EMPLOYEESEQUENCENO 'EmpID', A.COMPANYID 'BUID',CONCAT(md5(:userName),md5(:password)) PWD,A.EMPLOYEEID HRMSEMPLOYEEID,A.CALLNAME 'NAME',A.FIRSTNAME 'FIRSTNAME',A.LASTNAME 'LASTNAME', STATUS.NAME 'STATUS',co.NAME 'COSTCENTER', GEN.NAME 'GENDER', GEN.GENDER 'GENDERID', EMPLO.NAME 'EMPLOYMENT TYPE', IFNULL(STROKE.NAME,'--') 'INCREMENT TYPE',  IFNULL(IF(STATUS.NAME='ACTIVE','--',HR.DATE),'') 'LWD', DATE_FORMAT(A.DATEOFBIRTH,'%d-%m-%Y') 'DOB',  IFNULL(DATE_FORMAT(PROFILE.DATEOFJOIN,'%d-%M-%Y'),'') DOJ, BU.NAME 'DIVISION',  IFNULL(DES.NAME,'') 'DESIGNATION', IFNULL(DEP.NAME,'') 'DEPARTMENT',  CONCAT(MN.EMPLOYEESEQUENCENO,'-',MN.CALLNAME) 'Reportee',MS.NAME 'Reportee_Status', BANK.BANKID, IFNULL(BANK.BANKNAME,   'NA') 'BANKNAME', IFNULL(BIFSC.BANKIFC,'NA') 'IFSC', IFNULL(OTHER.ACCOUNTNO,'NA') 'ACCOUNTNO',   IFNULL(PRO.EMAIL,'') 'PROEMAIL', IFNULL(D.EMAIL,'') 'PEMAIL', IFNULL(OTHER.PFNO,     'NA') PFNO,   IFNULL(OTHER.ESINO,    'NA')ESINO, IFNULL(OTHER.PFUAN,    'NA')PFUAN, IFNULL(EMPST.STATE,'') STATE,   IFNULL(HQLOC.NAME,'') HQ, IFNULL(RLOC.NAME,'') REGION, IFNULL(PRO.MOBILE,'') 'PROFESSIONAL_MOBILE',   IFNULL(D.MOBILE,'')'PERSONAL_MOBILE', IFNULL(D.MOBILE,'')'PERSONAL_PHONE',   IFNULL(D.COMMUNICATIONADDRESS,'')COMMUNICATIONADDRESS,   IFNULL(D.COMMUNICATIONADDRESS2,'')COMMUNICATIONADDRESS2,   IFNULL(D.COMMUNICATIONADDRESS3,'')COMMUNICATIONADDRESS3,   IFNULL(D.COMMUNICATIONADDRESS4,'')COMMUNICATIONADDRESS4, IFNULL(COMMLOC.NAME,'') COMMCITY,   IFNULL(COMMSTATELOC.NAME,'')COMMSTATE, COMMSTATELOC.LOCATIONID COMMSTATE_LOCATIONID,COMMLOC.LOCATIONID COMMCITY_LOCATIONID,IFNULL(D.COMMUNICATIONZIP,'') COMM_ZIP,   IFNULL(D.PERMANENTADDRESS,'')PERMANENTADDRESS, IFNULL(D.PERMANENTADDRESS2,'')PERMANENTADDRESS2,   IFNULL(D.PERMANENTADDRESS3,'')PERMANENTADDRESS3, IFNULL(D.PERMANENTADDRESS4,'')PERMANENTADDRESS4,   IFNULL(PLOC.NAME,'') PCITY, IFNULL(PSLOC.NAME,'')PSTATE,IFNULL(D.PERMANENTZIP,'') PZIPCODE,PSLOC.LOCATIONID PERSTATE_LOCATIONID,PLOC.LOCATIONID PERCITY_LOCATIONID,IFNULL(INFO.PASSPORTNO,'') 'PASSPORTNO', IFNULL(INFO.AADHAARCARDNO,'') 'AADHAARCARDNO',   IFNULL(INFO.AADHAARUID,'NA') 'AADHAARUID', IFNULL(INFO.AADHAARNAME,'NA') 'AADHAARNAME',   IFNULL(INFO.PAN,'NA') 'PAN', IFNULL(IMPRS.assetpropertyvalue,'0.00') 'IMPRESTAMT',   QUALI.QUALIFICATION 'Education_Details', IFNULL(PREV.PREV,'0') 'Prev_Exp',CUREXP.Exp 'Cur_Exp' ,ice.ADDRESS ICEADDRESS,ice.ADDRESS2 ICEADDRESS2,ice.ADDRESS3 ICEADDRESS3,ice.ADDRESS4 ICEADDRESS4,ice.MOBILE ICEMOBILE,ice.FIRSTNAME ICE_FIRSTNAME,ice.LASTNAME ICE_LASTNAME,CONCAT(ice.FIRSTNAME,' ',ice.LASTNAME) CONTACTPERSONNAME,ICESTATELOC.NAME 'ICESTATE',ICELOC.NAME 'ICECITY',IFNULL(ICESTATELOC.LOCATIONID,'0') 'ICE_STATE_ID',IFNULL(ICELOC.LOCATIONID,'0') 'ICE_CITY_ID',rel.RELATIONID,rel.RELATIONNAME, CONCAT(SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1))/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1))/12, '.',-1)))*12,0)) TOTALEXP,NOW() TODAYDATE,BU.CODE LOCATION,IF(BU.BUSINESSUNITID in(15,16,33,34),'ASSAM',BU.CALLNAME) SUBLOCATION,DATEDIFF(NOW(),PROFILE.DATEOFJOIN)+1 WORKINGDAYS,IF(IFNULL(NT.EMPLOYEEID,'0')=0,'FALSE','TRUE') NOTICE,IF(SUBSTRING_INDEX(SUBSTRING_INDEX(procedure.GET_HOD_ID_NAME(A.EMPLOYEESEQUENCENO), '~', 2),'~', 1)='30546','TRUE',if('30546'=A.EMPLOYEESEQUENCENO,'TRUE' ,'FALSE')) WORKSHEET  FROM HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY A LEFT JOIN HCLADM_PROD.TBL_STATUS_CODES STATUS ON 	A.STATUS=STATUS.STATUS LEFT JOIN HCLADM_PROD.TBL_BUSINESSUNIT BU 	ON A.COMPANYID=BU.BUSINESSUNITID LEFT JOIN hclhrm_prod.tbl_employee_personal_contact D 	ON A.EMPLOYEEID=D.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PLOC 	ON D.PERMANENTLOCATIONID=PLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PSLOC ON PLOC.PARENT=PSLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMLOC ON D.COMMUNICATIONLOCATIONID=COMMLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMSTATELOC ON COMMLOC.PARENT=COMMSTATELOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_profile PROFILE ON A.EMPLOYEEID=PROFILE.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_details DD ON A.EMPLOYEEID=DD.EMPLOYEEID LEFT JOIN HCLADM_PROD.TBL_DEPARTMENT DEP ON DD.DEPARTMENTID=DEP.DEPARTMENTID LEFT JOIN HCLADM_PROD.TBL_DESIGNATION DES ON DD.DESIGNATIONID=DES.DESIGNATIONID LEFT JOIN test.empl_states EMPST ON A.EMPLOYEEID=EMPST.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION RLOC ON DD.SUBLOCATIONID=RLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION HQLOC ON DD.WORKLOCATIONID=HQLOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_other_detail OTHER ON A.EMPLOYEEID=OTHER.EMPLOYEEID LEFT JOIN hclhrm_prod_others.tbl_emp_bank_ifc BIFSC ON A.EMPLOYEEID=BIFSC.EMPID LEFT JOIN hcladm_prod.tbl_bank_details BANK ON OTHER.BANKID=BANK.BANKID LEFT JOIN HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY MN ON DD.MANAGERID=MN.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_status_codes MS ON MS.STATUS=MN.STATUS LEFT JOIN hclhrm_prod.tbl_employee_personalinfo INFO ON A.EMPLOYEEID=INFO.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_contact PRO ON A.EMPLOYEEID=PRO.EMPLOYEEID LEFT JOIN ( SELECT EMPLOYEEID,MAX(LASTWORKINGDATE) DATE FROM HCLHRM_PROD.TBL_EMPLOYEE_HRACTIONS GROUP BY EMPLOYEEID ) HR ON A.EMPLOYEEID=HR.EMPLOYEEID LEFT JOIN (  select  assetpropertyvalue,issueddate,returneddate,employeeid from  hclhrm_prod.tbl_employee_assets where assetid=16 and status=1001 group by employeeid )IMPRS ON  IMPRS.employeeid=A.employeeid  LEFT JOIN ( SELECT EMPLOYEEID,GROUP_CONCAT(QUALIFICATIONID,'-',YEAROFPASSING) QUALIFICATION FROM   hclhrm_prod.tbl_employee_education_details GROUP BY EMPLOYEEID ) QUALI ON A.EMPLOYEEID=QUALI.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1)/12,'.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1)/12,'.',-1)))*12,0)) 'Exp' FROM   HCLHRM_PROD.TBL_EMPLOYEE_PROFILE GROUP BY EMPLOYEEID ) CUREXP ON A.EMPLOYEEID=CUREXP.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',-1)))*12,0)) PREV,SUM(EXPERIENCE) TOTALPREV FROM   hclhrm_prod.tbl_employee_experience_details GROUP BY EMPLOYEEID ) PREV ON A.EMPLOYEEID=PREV.EMPLOYEEID   LEFT JOIN HCLHRM_PROD.tbl_employment_types EMPLO ON A.EMPLOYMENTTYPEID=EMPLO.EMPLOYMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_increment_type STROKE ON DD.INCREMENTTYPEID=STROKE.INCREMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_gender GEN ON A.GENDER=GEN.GENDER   LEFT JOIN hcladm_prod.tbl_costcenter co on co.COSTCENTERID=a.COSTCENTERID   left join hclhrm_prod.tbl_employee_login_temp lg on lg.employeeid=a.employeeid  left join tbl_employee_ice_contact ice on ice.employeeid=a.employeeid LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICELOC ON ICE.LOCATIONID=ICELOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICESTATELOC ON ICELOC.PARENT=ICESTATELOC.LOCATIONID LEFT JOIN  hclhrm_prod_others.tbl_iconnect_profile_pics pc on pc.employeeid=A.EMPLOYEESEQUENCENO LEFT JOIN hcladm_prod.tbl_relations rel on rel.RELATIONID=ice.RELATIONID LEFT JOIN test.tbl_employee_notice nt on nt.employeeid=A.EMPLOYEESEQUENCENO    WHERE  lg.EMPLOYEECODE=:userName and lg.password = MD5(:password) and a.status in(1001,1092,1401)   group by a.employeeid ORDER BY A.EMPLOYEESEQUENCENO ;", nativeQuery = true)
	    // @Query(value = "select * from mst_user mu INNER JOIN mst_patient mp ON mp.patient_user_id = mu.user_id where mp.patient_mr_no = :userName AND mu.password = :password and mu.is_user_or_staff=false", nativeQuery = true)
     LoginUser findByUsernameandpasswordTemp(@Param("userName") String userName, @Param("password") String password);
 
	 @Query(value = "SELECT A.EMPLOYEESEQUENCENO 'EmpID', A.COMPANYID 'BUID',CONCAT(md5(:userName)) PWD,A.EMPLOYEEID HRMSEMPLOYEEID, A.CALLNAME 'NAME',A.FIRSTNAME 'FIRSTNAME',A.LASTNAME 'LASTNAME', STATUS.NAME 'STATUS',co.NAME 'COSTCENTER', GEN.NAME 'GENDER', GEN.GENDER 'GENDERID', EMPLO.NAME 'EMPLOYMENT TYPE', IFNULL(STROKE.NAME,'--') 'INCREMENT TYPE',  IFNULL(IF(STATUS.NAME='ACTIVE','--',HR.DATE),'') 'LWD', DATE_FORMAT(A.DATEOFBIRTH,'%d-%m-%Y') 'DOB',  IFNULL(DATE_FORMAT(PROFILE.DATEOFJOIN,'%d-%M-%Y'),'') DOJ, BU.NAME 'DIVISION',  IFNULL(DES.NAME,'') 'DESIGNATION', IFNULL(DEP.NAME,'') 'DEPARTMENT',  CONCAT(MN.EMPLOYEESEQUENCENO,'-',MN.CALLNAME) 'Reportee',MS.NAME 'Reportee_Status',BANK.BANKID,IFNULL(BANK.BANKNAME,   'NA') 'BANKNAME', IFNULL(BIFSC.BANKIFC,'NA') 'IFSC', IFNULL(OTHER.ACCOUNTNO,'NA') 'ACCOUNTNO',   IFNULL(PRO.EMAIL,'') 'PROEMAIL', IFNULL(D.EMAIL,'') 'PEMAIL', IFNULL(OTHER.PFNO,     'NA') PFNO,   IFNULL(OTHER.ESINO,    'NA')ESINO, IFNULL(OTHER.PFUAN,    'NA')PFUAN, IFNULL(EMPST.STATE,'') STATE,   IFNULL(HQLOC.NAME,'') HQ, IFNULL(RLOC.NAME,'') REGION, IFNULL(PRO.MOBILE,'') 'PROFESSIONAL_MOBILE',   IFNULL(D.MOBILE,'')'PERSONAL_MOBILE', IFNULL(D.MOBILE,'')'PERSONAL_PHONE',   IFNULL(D.COMMUNICATIONADDRESS,'')COMMUNICATIONADDRESS,   IFNULL(D.COMMUNICATIONADDRESS2,'')COMMUNICATIONADDRESS2,   IFNULL(D.COMMUNICATIONADDRESS3,'')COMMUNICATIONADDRESS3,   IFNULL(D.COMMUNICATIONADDRESS4,'')COMMUNICATIONADDRESS4, IFNULL(COMMLOC.NAME,'') COMMCITY,   IFNULL(COMMSTATELOC.NAME,'')COMMSTATE, COMMSTATELOC.LOCATIONID COMMSTATE_LOCATIONID,COMMLOC.LOCATIONID COMMCITY_LOCATIONID,IFNULL(D.COMMUNICATIONZIP,'') COMM_ZIP,   IFNULL(D.PERMANENTADDRESS,'')PERMANENTADDRESS, IFNULL(D.PERMANENTADDRESS2,'')PERMANENTADDRESS2,   IFNULL(D.PERMANENTADDRESS3,'')PERMANENTADDRESS3, IFNULL(D.PERMANENTADDRESS4,'')PERMANENTADDRESS4,   IFNULL(PLOC.NAME,'') PCITY, IFNULL(PSLOC.NAME,'')PSTATE,IFNULL(D.PERMANENTZIP,'') PZIPCODE,PSLOC.LOCATIONID PERSTATE_LOCATIONID,PLOC.LOCATIONID PERCITY_LOCATIONID,IFNULL(INFO.PASSPORTNO,'') 'PASSPORTNO', IFNULL(INFO.AADHAARCARDNO,'') 'AADHAARCARDNO',   IFNULL(INFO.AADHAARUID,'NA') 'AADHAARUID', IFNULL(INFO.AADHAARNAME,'NA') 'AADHAARNAME',   IFNULL(INFO.PAN,'NA') 'PAN', IFNULL(IMPRS.assetpropertyvalue,'0.00') 'IMPRESTAMT',   QUALI.QUALIFICATION 'Education_Details', IFNULL(PREV.PREV,'0') 'Prev_Exp',CUREXP.Exp 'Cur_Exp' ,ice.ADDRESS ICEADDRESS,ice.ADDRESS2 ICEADDRESS2,ice.ADDRESS3 ICEADDRESS3,ice.ADDRESS4 ICEADDRESS4,ice.MOBILE ICEMOBILE,ice.FIRSTNAME ICE_FIRSTNAME,ice.LASTNAME ICE_LASTNAME,CONCAT(ice.FIRSTNAME,' ',ice.LASTNAME) CONTACTPERSONNAME,ICESTATELOC.NAME 'ICESTATE',ICELOC.NAME 'ICECITY',IFNULL(ICESTATELOC.LOCATIONID,'0') 'ICE_STATE_ID',IFNULL(ICELOC.LOCATIONID,'0') 'ICE_CITY_ID',rel.RELATIONID,rel.RELATIONNAME, CONCAT(SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1))/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX((TOTALPREV+TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1))/12, '.',-1)))*12,0)) TOTALEXP,NOW() TODAYDATE,BU.CODE LOCATION,IF(BU.BUSINESSUNITID in(15,16,33,34),'ASSAM',BU.CALLNAME) SUBLOCATION,DATEDIFF(NOW(),PROFILE.DATEOFJOIN)+1 WORKINGDAYS,IF(IFNULL(NT.EMPLOYEEID,'0')=0,'FALSE','TRUE') NOTICE,IF(SUBSTRING_INDEX(SUBSTRING_INDEX(procedure.GET_HOD_ID_NAME(A.EMPLOYEESEQUENCENO), '~', 2),'~', 1)='30546','TRUE',if('30546'=A.EMPLOYEESEQUENCENO,'TRUE' ,'FALSE')) WORKSHEET FROM HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY A LEFT JOIN HCLADM_PROD.TBL_STATUS_CODES STATUS ON 	A.STATUS=STATUS.STATUS LEFT JOIN HCLADM_PROD.TBL_BUSINESSUNIT BU 	ON A.COMPANYID=BU.BUSINESSUNITID LEFT JOIN hclhrm_prod.tbl_employee_personal_contact D 	ON A.EMPLOYEEID=D.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PLOC 	ON D.PERMANENTLOCATIONID=PLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION PSLOC ON PLOC.PARENT=PSLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMLOC ON D.COMMUNICATIONLOCATIONID=COMMLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION COMMSTATELOC ON COMMLOC.PARENT=COMMSTATELOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_profile PROFILE ON A.EMPLOYEEID=PROFILE.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_details DD ON A.EMPLOYEEID=DD.EMPLOYEEID LEFT JOIN HCLADM_PROD.TBL_DEPARTMENT DEP ON DD.DEPARTMENTID=DEP.DEPARTMENTID LEFT JOIN HCLADM_PROD.TBL_DESIGNATION DES ON DD.DESIGNATIONID=DES.DESIGNATIONID LEFT JOIN test.empl_states EMPST ON A.EMPLOYEEID=EMPST.EMPLOYEEID LEFT JOIN HCLLCM_PROD.TBL_LOCATION RLOC ON DD.SUBLOCATIONID=RLOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION HQLOC ON DD.WORKLOCATIONID=HQLOC.LOCATIONID LEFT JOIN hclhrm_prod.tbl_employee_other_detail OTHER ON A.EMPLOYEEID=OTHER.EMPLOYEEID LEFT JOIN hclhrm_prod_others.tbl_emp_bank_ifc BIFSC ON A.EMPLOYEEID=BIFSC.EMPID LEFT JOIN hcladm_prod.tbl_bank_details BANK ON OTHER.BANKID=BANK.BANKID LEFT JOIN HCLHRM_PROD.TBL_EMPLOYEE_PRIMARY MN ON DD.MANAGERID=MN.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_status_codes MS ON MS.STATUS=MN.STATUS LEFT JOIN hclhrm_prod.tbl_employee_personalinfo INFO ON A.EMPLOYEEID=INFO.EMPLOYEEID LEFT JOIN hclhrm_prod.tbl_employee_professional_contact PRO ON A.EMPLOYEEID=PRO.EMPLOYEEID LEFT JOIN ( SELECT EMPLOYEEID,MAX(LASTWORKINGDATE) DATE FROM HCLHRM_PROD.TBL_EMPLOYEE_HRACTIONS GROUP BY EMPLOYEEID ) HR ON A.EMPLOYEEID=HR.EMPLOYEEID LEFT JOIN (  select  assetpropertyvalue,issueddate,returneddate,employeeid from  hclhrm_prod.tbl_employee_assets where assetid=16 and status=1001 group by employeeid )IMPRS ON  IMPRS.employeeid=A.employeeid  LEFT JOIN ( SELECT EMPLOYEEID,GROUP_CONCAT(QUALIFICATIONID,'-',YEAROFPASSING) QUALIFICATION FROM   hclhrm_prod.tbl_employee_education_details GROUP BY EMPLOYEEID ) QUALI ON A.EMPLOYEEID=QUALI.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH,DATEOFJOIN, NOW()+1)/12,'.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(TIMESTAMPDIFF(MONTH, DATEOFJOIN, NOW()+1)/12,'.',-1)))*12,0)) 'Exp' FROM   HCLHRM_PROD.TBL_EMPLOYEE_PROFILE GROUP BY EMPLOYEEID ) CUREXP ON A.EMPLOYEEID=CUREXP.EMPLOYEEID   LEFT JOIN ( SELECT EMPLOYEEID,CONCAT(SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',1),'.',ROUND((CONCAT('0.',SUBSTRING_INDEX(SUM(EXPERIENCE)/12, '.',-1)))*12,0)) PREV,SUM(EXPERIENCE) TOTALPREV FROM   hclhrm_prod.tbl_employee_experience_details GROUP BY EMPLOYEEID ) PREV ON A.EMPLOYEEID=PREV.EMPLOYEEID   LEFT JOIN HCLHRM_PROD.tbl_employment_types EMPLO ON A.EMPLOYMENTTYPEID=EMPLO.EMPLOYMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_increment_type STROKE ON DD.INCREMENTTYPEID=STROKE.INCREMENTTYPEID   LEFT JOIN HCLADM_PROD.tbl_gender GEN ON A.GENDER=GEN.GENDER   LEFT JOIN hcladm_prod.tbl_costcenter co on co.COSTCENTERID=a.COSTCENTERID   left join hclhrm_prod.tbl_employee_login_temp lg on lg.employeeid=a.employeeid  left join tbl_employee_ice_contact ice on ice.employeeid=a.employeeid LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICELOC ON ICE.LOCATIONID=ICELOC.LOCATIONID LEFT JOIN HCLLCM_PROD.TBL_LOCATION ICESTATELOC ON ICELOC.PARENT=ICESTATELOC.LOCATIONID LEFT JOIN  hclhrm_prod_others.tbl_iconnect_profile_pics pc on pc.employeeid=A.EMPLOYEESEQUENCENO  LEFT JOIN hcladm_prod.tbl_relations rel on rel.RELATIONID=ice.RELATIONID LEFT JOIN test.tbl_employee_notice nt on nt.employeeid=A.EMPLOYEESEQUENCENO  WHERE  A.EMPLOYEESEQUENCENO=:userName  and a.status in(1001,1092,1401)   group by a.employeeid ORDER BY A.EMPLOYEESEQUENCENO ;", nativeQuery = true)
	  LoginUser findByUsernameTemp(@Param("userName") String userName);
	 
   ////
	 
	// Employee SelfCancel
    @Transactional
    @Modifying (clearAutomatically = true)
    @Query(value = "UPDATE hclhrm_prod_others.tbl_emp_attn_req set FLAG='SC',comments=:reasonComment,approvedby=:empID, approvedname=:empName, MAIL_STATUS='N'  WHERE FLAG in('P') AND EMPLOYEEID=:empID AND RID=:rid", nativeQuery = true)
    int findbySelfCancel(@Param("reasonComment") String comments,@Param("empID") String LOGINID,@Param("empName") String LOGINNAME,@Param("rid") String rid);
    
    // MANGER LEAVE Acccept & Reject & Approve
    @Transactional
    @Modifying (clearAutomatically = true)
    @Query(value = "UPDATE hclhrm_prod_others.tbl_emp_attn_req set FLAG=:managereqflag,comments=:reasonComment,approvedby=:LOGINID,approvedname=:LOGINNAME,MAIL_STATUS='N' WHERE FLAG in('P','A') AND EMPLOYEEID=:id AND RID=:rid", nativeQuery = true)
    int findbyLeaveaccept(@Param("managereqflag") String flag,@Param("reasonComment") String comments,@Param("LOGINID") String LOGINID,@Param("LOGINNAME") String LOGINNAME,@Param("id") String empid,@Param("rid") String rid);
    
    
    ////  Attendance Request
    
    @Transactional
    @Modifying (clearAutomatically = true)
    @Query(value = "INSERT INTO hclhrm_prod_others.tbl_emp_attn_req (EMPLOYEEID,SUBJECT,REQ_DATE,MESSAGE,RANDOMID,FROM_DATE,TO_DATE,TOTA_HOURS,TO_EMAIL,DED_HOURS)"
    		+ " select :EMPLOYEEID,:SUBJECT,:REQ_DATE,:MESSAGE,:RANDOMID,:FROM_DATE,:TO_DATE,:netHours,:TO_EMAIL,:TOTA_HOURS from Dual", nativeQuery = true)
    int findbyattrequest(@Param("EMPLOYEEID") String EMPLOYEEID,@Param("SUBJECT") String SUBJECT,@Param("REQ_DATE") String REQ_DATE,@Param("MESSAGE")
    String MESSAGE,@Param("RANDOMID") String RANDOMID,@Param("FROM_DATE") String FROM_DATE,
    @Param("TO_DATE") String TO_DATE,@Param("netHours") String TOTA_HOURS,@Param("TO_EMAIL") String TO_EMAIL,@Param("TOTA_HOURS") String netHours);
    
    
    ////   Profile PIC
    @Transactional
    @Modifying (clearAutomatically = true)
   // @Query(value = "INSERT INTO hclhrm_prod_others.tbl_iconnect_profile_pics(EMPLOYEEID, FILEPATH, FILENAME, FILETYPE) select :EMPLOYEEID,:FILEPATH,:FILENAME,:FILETYPE from Dual", nativeQuery = true)
    
    @Query(value = "INSERT INTO hclhrm_prod_others.tbl_iconnect_profile_pics(EMPLOYEEID, FILEPATH, FILENAME, FILETYPE) VALUES(:EMPLOYEEID,:FILEPATH,:FILENAME,:FILETYPE) ON DUPLICATE KEY UPDATE  FILEPATH=:FILEPATH, FILENAME=:FILENAME, FILETYPE=:FILETYPE", nativeQuery = true)
    int profilepic(@Param("EMPLOYEEID") String EMPLOYEEID,@Param("FILEPATH") String FILEPATH,@Param("FILENAME") String FILENAME,@Param("FILETYPE") String FILETYPE);
     
    /// Change Password
    @Transactional
    @Modifying (clearAutomatically = true)
    @Query(value = "update hclhrm_prod.tbl_employee_login SET PASSWORD=md5(:confrmPassword),DATEMODIFIED=now(),modifiedby=:empID where employeecode=:empID and STATUS=1001 limit 1", nativeQuery = true)
    int changepassword(@Param("confrmPassword") String confrmPassword,@Param("empID") String LOGINID);
    
    
    ///IConnect User Tracking
     
	/*
	 * @Transactional
	 * 
	 * @Modifying (clearAutomatically = true)
	 * 
	 * @Query(value =
	 * "INSERT INTO hclhrm_prod_others.tbl_iconnect_user_history (USERID,VIEWNAME) SELECT :USERID,:VIEWNAME  from Dual"
	 * , nativeQuery = true) int usertrack(@Param("USERID") String
	 * USERID,@Param("VIEWNAME") String VIEWNAME);
	 */
    
    
    @Transactional
    @Modifying (clearAutomatically = true)
    @Query(value = "INSERT INTO hclhrm_prod_others.tbl_iconnect_user_history (USERID,VIEWNAME,APPLICATION) SELECT :USERID,:VIEWNAME,:APPLICATION  from Dual", nativeQuery = true)
    int usertrack(@Param("USERID") String USERID,@Param("VIEWNAME") String VIEWNAME,@Param("APPLICATION") String APPLICATION);
    
    
    /*SNO, USERID, IP, country_code, country_name,
    Object, VIEWNAME, application, ACCESSDATE*/
    
    
    @Query(value = "SELECT IFNULL(CONCAT('iconnectpics/', employeeid,'/',filename),0) PROFILEPIC FROM hclhrm_prod_others.tbl_iconnect_profile_pics where employeeid=:empID", nativeQuery = true)
    String findByProfilepicview(@Param("empID") String LOGINID);

    
    /*@Query(value = "SELECT a.NAME annoucement FROM hclhrm_prod_others.tbl_bu_annoucement a left join hcladm_prod.tbl_businessunit b on a.businessunitid=b.businessunitid where b.businessunitid=:buid", nativeQuery = true)
    String findByAnnoucement(@Param("buid") String LOGINID); 
*/
    /*SELECT a.NAME annoucement FROM hclhrm_prod_others.tbl_bu_annoucement a left join hcladm_prod.tbl_businessunit b on a.businessunitid=b.businessunitid where b.businessunitid=11;*/
   
    @Query(value = "SELECT COUNT(*) COUNT FROM hhcl_appraisal.primarytable where EMPLOYEE_CODE=:empID", nativeQuery = true)
    String appraisal(@Param("empID") String LOGINID);
    
     @Query(value = " SELECT IFNULL(PAN,0) FROM hclhrm_prod.tbl_employee_primary a left JOIN  hclhrm_prod.tbl_employee_personalinfo b on a.employeeid=b.employeeid where a.employeesequenceno=:empID", nativeQuery = true)
    String PanNumber(@Param("empID") String LOGINID);

}
            
